<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>GAME SHOT</title>
    <style>
        body { margin: 0; background: #222; color: white; font-family: sans-serif; overflow: hidden; }
        #menu { position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(0,0,0,0.8); z-index: 10; }
        canvas { display: block; background: #333; cursor: crosshair; }
        .btn { padding: 15px 30px; margin: 10px; cursor: pointer; background: #e74c3c; border: none; color: white; font-weight: bold; }
        input { padding: 10px; font-size: 1.2rem; text-align: center; width: 150px; }
    </style>
</head>
<body>

<div id="menu">
    <h1>GAME SHOT</h1>
    <button class="btn" onclick="startTraining()">MODO TREINAMENTO</button>
    <hr style="width: 200px; border: 0.5px solid #555;">
    <h3>MODO ONLINE (1v1)</h3>
    <button class="btn" style="background: #27ae60;" onclick="createRoom()">CRIAR CÓDIGO</button>
    <div style="margin-top: 10px;">
        <input type="text" id="roomInput" placeholder="000000" maxlength="6">
        <button class="btn" style="background: #2980b9;" onclick="joinRoom()">ENTRAR</button>
    </div>
    <p id="status"></p>
</div>

<canvas id="gameCanvas"></canvas>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // Suas configurações extraídas da imagem
    const firebaseConfig = {
        apiKey: "AIzaSyDqYWTRKvmyjRM-to5raljV464Zvott4eM",
        authDomain: "whitermultiplayer.firebaseapp.com",
        databaseURL: "https://whitermultiplayer-default-rtdb.firebaseio.com",
        projectId: "whitermultiplayer",
        storageBucket: "whitermultiplayer.firebasestorage.app",
        messagingSenderId: "859405698218",
        appId: "1:859405698218:web:44b4d4e1a96c937373cd3",
        measurementId: "G-HQ5JZV5NS3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Variáveis do Jogo
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let player = { x: 100, y: 100, color: 'blue', lastShot: 0 };
    let enemy = { x: -100, y: -100, color: 'red' };
    let roomId = null;
    let isPlayer1 = false;

    // --- LÓGICA DE SALAS ---
    window.createRoom = function() {
        const code = Math.floor(100000 + Math.random() * 900000).toString();
        roomId = code;
        isPlayer1 = true;
        set(ref(db, 'rooms/' + roomId), { p1: { x: 100, y: 100 }, status: 'waiting' });
        document.getElementById('status').innerText = "Código da Sala: " + code;
        observeRoom();
    };

    window.joinRoom = function() {
        const code = document.getElementById('roomInput').value;
        if(code.length === 6) {
            roomId = code;
            isPlayer1 = false;
            update(ref(db, 'rooms/' + roomId), { p2: { x: 500, y: 500 }, status: 'playing' });
            document.getElementById('menu').style.display = 'none';
            observeRoom();
        }
    };

    function observeRoom() {
        onValue(ref(db, 'rooms/' + roomId), (snapshot) => {
            const data = snapshot.val();
            if(data.status === 'playing') document.getElementById('menu').style.display = 'none';
            if(isPlayer1 && data.p2) enemy = data.p2;
            if(!isPlayer1 && data.p1) enemy = data.p1;
        });
    }

    // --- LÓGICA DO JOGO ---
    window.addEventListener('mousemove', (e) => {
        if(!roomId) return;
        player.x = e.clientX;
        player.y = e.clientY;
        
        // Atualiza posição no Firebase
        const path = isPlayer1 ? `rooms/${roomId}/p1` : `rooms/${roomId}/p2`;
        update(ref(db, path), { x: player.x, y: player.y });
    });

    window.addEventListener('click', () => {
        const agora = Date.now();
        if(agora - player.lastShot > 500) { // Delay de 0.5s
            console.log("TIRO!");
            player.lastShot = agora;
            // Aqui entra a lógica de raio (raycasting) para acertar o inimigo
        }
    });

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Desenha Jogador
        ctx.beginPath();
        ctx.arc(player.x, player.y, 20, 0, Math.PI*2);
        ctx.fillStyle = player.color;
        ctx.fill();

        // Desenha Inimigo
        ctx.beginPath();
        ctx.arc(enemy.x, enemy.y, 20, 0, Math.PI*2);
        ctx.fillStyle = enemy.color;
        ctx.fill();

        requestAnimationFrame(draw);
    }
    draw();

    window.startTraining = () => {
        document.getElementById('menu').style.display = 'none';
        roomId = "training"; // Simula modo offline
    };
</script>
</body>
</html>
