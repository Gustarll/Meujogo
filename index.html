<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Whiter Battle - Sistema CO-OP</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <style>
        body { margin: 0; background: #1a1a2e; color: white; font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        #game-board { position: relative; width: 800px; height: 500px; background: #b8b8b8; border: 4px solid #16213e; display: none; overflow: hidden; }
        #player { position: absolute; width: 40px; height: 40px; background: #e94560; border-radius: 8px; z-index: 10; }
        .other-player { position: absolute; width: 40px; height: 40px; background: #0077ff; border-radius: 8px; z-index: 9; }
        .enemy { position: absolute; width: 30px; height: 30px; background: #2ecc71; border-radius: 5px; }
        .player-name { position: absolute; top: -20px; width: 100px; text-align: center; left: -30px; font-size: 12px; font-weight: bold; }
        
        /* O PAINEL QUE VOCÊ QUER */
        #login-screen, #config-panel { position: fixed; inset: 0; background: rgba(26, 26, 46, 0.95); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 1000; }
        #config-panel { display: none; } /* Começa escondido */
        
        button { padding: 15px 30px; cursor: pointer; background: #e94560; color: white; border: none; border-radius: 8px; margin: 10px; font-weight: bold; font-size: 16px; min-width: 250px; }
        input { padding: 12px; margin: 10px; border-radius: 8px; border: none; width: 200px; text-align: center; }
        .codigo-sala { font-size: 24px; color: #f9ed69; margin: 20px; font-weight: bold; border: 2px dashed #f9ed69; padding: 10px; }
    </style>
</head>
<body>

    <div id="login-screen">
        <h1>WHITER BATTLE</h1>
        <input type="text" id="username-input" placeholder="Seu nome..." maxlength="10">
        <button onclick="startGame()">ENTRAR NO JOGO</button>
    </div>

    <div id="config-panel">
        <h2>MODO CO-OP / PAUSE</h2>
        <button onclick="createRoom()" style="background: #0077ff;">CRIAR SALA (6 DÍGITOS)</button>
        <button onclick="joinRoomPrompt()" style="background: #2ecc71;">ENTRAR EM SALA EXISTENTE</button>
        <div id="room-display" class="codigo-sala">SEM SALA</div>
        <button onclick="toggleMenu()" style="background: #555;">FECHAR MENU (ESC)</button>
    </div>

    <div id="game-board">
        <div id="player"><div class="player-name" id="my-name-tag"></div></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDqYWTRKvmyjRM-to5raljV464Zvott4eM",
            authDomain: "whitermultiplayer.firebaseapp.com",
            databaseURL: "https://whitermultiplayer-default-rtdb.firebaseio.com/",
            projectId: "whitermultiplayer",
            storageBucket: "whitermultiplayer.firebasestorage.app",
            messagingSenderId: "859405698218",
            appId: "1:859405698218:web:44b4d4e4d1a96c93737cd3"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let playerRef, roomRef, myID;
        let posX = 380, posY = 230, isPaused = false, isStarted = false;
        const keys = {}, enemies = [], allPlayers = {};

        function startGame() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('game-board').style.display = 'block';
            document.getElementById('my-name-tag').innerText = document.getElementById('username-input').value || "Player";
            isStarted = true;
            requestAnimationFrame(gameLoop);
        }

        // --- SISTEMA DE SALAS ---
        function createRoom() {
            const code = Math.floor(100000 + Math.random() * 900000); // Gera 6 dígitos
            connectToRoom(code);
        }

        function joinRoomPrompt() {
            const code = prompt("Digite o código da sala:");
            if(code) connectToRoom(code);
        }

        function connectToRoom(code) {
            if (playerRef) playerRef.remove();
            roomRef = db.ref('rooms/' + code);
            playerRef = roomRef.child('players').push();
            myID = playerRef.key;
            playerRef.set({ name: document.getElementById('my-name-tag').innerText, x: posX, y: posY });
            playerRef.onDisconnect().remove();

            roomRef.on('value', snap => {
                const data = snap.val() || {};
                isPaused = data.isPaused || false;
                // Sincroniza o menu apenas se o ADM pausar
                if(isPaused) document.getElementById('config-panel').style.display = 'flex';
                
                const players = data.players || {};
                document.querySelectorAll('.other-player').forEach(el => el.remove());
                for (let id in players) {
                    allPlayers[id] = players[id];
                    if (id !== myID) {
                        const p = players[id], el = document.createElement('div');
                        el.className = 'other-player';
                        el.style.left = p.x + 'px'; el.style.top = p.y + 'px';
                        el.innerHTML = `<div class="player-name">${p.name}</div>`;
                        document.getElementById('game-board').appendChild(el);
                    }
                }
            });
            document.getElementById('room-display').innerText = "CÓDIGO: " + code;
            toggleMenu(); // Fecha o menu após entrar
        }

        function toggleMenu() {
            if (!isStarted) return;
            const panel = document.getElementById('config-panel');
            const isVisible = panel.style.display === 'flex';
            panel.style.display = isVisible ? 'none' : 'flex';

            // Se for o ADM "Gusta", ele controla o tempo do jogo para todos
            const myName = document.getElementById('my-name-tag').innerText;
            if (roomRef && myName === "Gusta") {
                roomRef.child('isPaused').set(!isVisible);
            }
        }

        window.addEventListener('keydown', e => { 
            keys[e.key.toLowerCase()] = true; 
            if(e.key === 'escape') toggleMenu();
        });
        window.addEventListener('keyup', e => delete keys[e.key.toLowerCase()]);

        function gameLoop() {
            if (isStarted && !isPaused) {
                if (keys['w'] && posY > 0) posY -= 5;
                if (keys['s'] && posY < 460) posY += 5;
                if (keys['a'] && posX > 0) posX -= 5;
                if (keys['d'] && posX < 760) posX += 5;

                const pEl = document.getElementById('player');
                pEl.style.left = posX + 'px'; pEl.style.top = posY + 'px';
                if (playerRef) playerRef.update({ x: posX, y: posY });
            }
            requestAnimationFrame(gameLoop);
        }
    </script>
</body>
</html>
